
@using CaPPMS.Model
@namespace CaPPMS.Shared
@inject ProjectManagerService ProjectManager

<div>
    <EditForm Model="@this.ProjectInformation" OnValidSubmit="@HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div class="p-5">

            
            <label>
                Semester Term:
                <select class="form-control" id="SemesterTerm" name="SemesterTerm" @bind="this.projectInformation.SemesterTerm">
                    @foreach(string term in projectInformation.Terms)
                {
                        if(this.projectInformation.SemesterTerm.Equals(term))
                    {
                        <option selected="selected">@term</option>
                    }
                    else
                    {
                        <option>@term</option>
                    }                    
                }
                    
                </select>
            </label>

            <label>
                Semester Year:
                <select class="form-control" id="SemesterYear" name="SemesterYear" @bind="this.projectInformation.SemesterYear">
                    @foreach (string year in projectInformation.Years)
                    {
                        if (this.projectInformation.SemesterYear.Equals(year))
                        {
                            <option selected="selected">@year</option>
                        }
                        else
                        {
                            <option>@year</option>
                        }
                    }

                </select>
            </label>
            <br />
            @foreach (CompletedProjectDocumentation completedTeam in this.ProjectInformation.CompletedDocuments)
            {
                <label>Team: @completedTeam.TeamName</label>
                <br />
            }
            <br />
            <button class="btn btn-primary" type="button" @onclick="e => teamsClicked = !teamsClicked">Add Team</button>
            @if (teamsClicked)
            {
                <CompleteProjectComponent @bind-ProjectInformation="projectInformation" @bind-IsOpen="teamsClicked"/>
            }

            <hr />
            <button id="completeProjectBtn" type="submit" class="btn-primary" >
                Complete Project
            </button>


            <button @onclick="e => this.CancelComplete()">
                Cancel
            </button>

        </div>
    </EditForm>
</div>


@code {
        [Parameter] public EventCallback<ProjectInformation> ProjectInformationChanged { get; set; }
        [Parameter]
        public ProjectInformation ProjectInformation
    {
            get { return projectInformation; }
            set
        {
                projectInformation = value;
            }
        }

    private List<string> years { get; set; } = new List<string>();
    public ProjectInformation projectInformation = new ProjectInformation();
    private bool teamsClicked = false;

    private void CancelComplete()
    {
        this.projectInformation = null;
    }

    private async Task HandleValidSubmit()
    {
        await Task.Run(async () =>
        {
            ProjectManager.CompleteProject(projectInformation);
            await Task.Delay(2000);

        });
    }
}
